# vi:syntax=dockerfile
FROM node:lts-slim as builder
WORKDIR /
RUN npm install --save git+https://github.com/standardnotes/web.git#3.3.1 && \
    cd /node_modules/standard-notes-web && \
    rm -rf README.md LICENSE package.json docker Dockerfile log && \
    cd public/extensions && \
    rm -rf batch-manager/app extension-manager/app && \
    cd /node_modules && \
    find -type f \( -name "README.md" \
                    -o -name ".*" \
                    -o -name "webpack.config.js" \
                    -o -name "yarn.lock" \
                    -o -name "*.map" \) | xargs rm && \
    cd / && \
    wget https://github.com/weihanglo/sfz/releases/download/0.1.1/sfz-0.1.1-x86_64-unknown-linux-musl.tar.gz -O sfz.tar.gz && \
    tar xf sfz.tar.gz && \
    rm sfz.tar.gz

FROM scratch
WORKDIR /
COPY --from=builder /node_modules/standard-notes-web/ /
COPY --from=builder /sfz /

ENTRYPOINT [ "/sfz" ]
